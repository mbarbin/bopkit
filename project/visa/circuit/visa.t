In this test, we run the microprocessor on the `calendar.bin` executable with
the bopkit simulator. We go through specific ranges of times to monitor that the
behavior of the microprocessor is inlined with the behavior obtained during the
simulation of the `calendar.asm` program with the visa-simulator.

The test cases are adapted from `visa-simulator.t`.

  $ visa_run () {
  >   bopkit simu visa.bop -num-cycles $1 \
  >     -parameter 'InitialMemory=test-memory.txt' \
  >     -parameter 'WithPulse=0' \
  >     -output-only \
  >   | bopkit digital-calendar map-raw-input \
  >   | bopkit digital-calendar print -print-index -print-on-change
  > }

  $ visa_run_date () {
  >   ./get_date.exe $1 $2 > test-memory.txt
  >   visa_run $3
  > }

The first test is from an initial memory that only contains zeros.

  $ echo '' > test-memory.txt

  $ visa_run 5000
  0000: 01/01/00 - 00:00:00
  2052: 01/01/00 - 00:00:01
  3076: 01/01/00 - 00:00:02
  4100: 01/01/00 - 00:00:03

End of January.

For a detailed explanation of the behavior seen below, see `visa-simulator.t`,
since the behavior is not specific to the execution of the microprocessor, but
rather comes from the way `calendar.asm` is implemented. We check here that the
execution of the microprocessor is in par with that of the visa-simulator.

  $ visa_run_date 23:59:58 2023/01/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:58
  1032: 01/01/00 - 00:59:58
  1036: 01/01/00 - 23:59:58
  1040: 31/01/00 - 23:59:58
  1048: 31/01/23 - 23:59:58
  2052: 31/01/23 - 23:59:59
  3076: 31/01/23 - 23:59:00
  3080: 31/01/23 - 23:00:00
  3084: 31/01/23 - 00:00:00
  3088: 01/01/23 - 00:00:00
  3092: 01/02/23 - 00:00:00
  4100: 01/02/23 - 00:00:01

End of February when it has 28 days.

  $ visa_run_date 23:59:59 2023/02/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  1048: 28/02/23 - 23:59:59
  2052: 28/02/23 - 23:59:00
  2056: 28/02/23 - 23:00:00
  2060: 28/02/23 - 00:00:00
  2064: 01/02/23 - 00:00:00
  2068: 01/03/23 - 00:00:00
  3076: 01/03/23 - 00:00:01
  4100: 01/03/23 - 00:00:02

End of February when it has 29 days.

  $ visa_run_date 23:59:59 2024/02/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  1048: 28/02/24 - 23:59:59
  2052: 28/02/24 - 23:59:00
  2056: 28/02/24 - 23:00:00
  2060: 28/02/24 - 00:00:00
  2064: 29/02/24 - 00:00:00
  3076: 29/02/24 - 00:00:01
  4100: 29/02/24 - 00:00:02

  $ visa_run_date 23:59:59 2024/02/29 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 29/01/00 - 23:59:59
  1044: 29/02/00 - 23:59:59
  1048: 29/02/24 - 23:59:59
  2052: 29/02/24 - 23:59:00
  2056: 29/02/24 - 23:00:00
  2060: 29/02/24 - 00:00:00
  2064: 01/02/24 - 00:00:00
  2068: 01/03/24 - 00:00:00
  3076: 01/03/24 - 00:00:01
  4100: 01/03/24 - 00:00:02

More on Leap Years at the end of the test.

End of March.

  $ visa_run_date 23:59:59 2023/03/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/03/00 - 23:59:59
  1048: 30/03/23 - 23:59:59
  2052: 30/03/23 - 23:59:00
  2056: 30/03/23 - 23:00:00
  2060: 30/03/23 - 00:00:00
  2064: 31/03/23 - 00:00:00
  3076: 31/03/23 - 00:00:01
  4100: 31/03/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/03/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/03/00 - 23:59:59
  1048: 31/03/23 - 23:59:59
  2052: 31/03/23 - 23:59:00
  2056: 31/03/23 - 23:00:00
  2060: 31/03/23 - 00:00:00
  2064: 01/03/23 - 00:00:00
  2068: 01/04/23 - 00:00:00
  3076: 01/04/23 - 00:00:01
  4100: 01/04/23 - 00:00:02

End of April.

  $ visa_run_date 23:59:59 2023/04/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/04/00 - 23:59:59
  1048: 30/04/23 - 23:59:59
  2052: 30/04/23 - 23:59:00
  2056: 30/04/23 - 23:00:00
  2060: 30/04/23 - 00:00:00
  2064: 01/04/23 - 00:00:00
  2068: 01/05/23 - 00:00:00
  3076: 01/05/23 - 00:00:01
  4100: 01/05/23 - 00:00:02

End of May.

  $ visa_run_date 23:59:59 2023/05/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/05/00 - 23:59:59
  1048: 30/05/23 - 23:59:59
  2052: 30/05/23 - 23:59:00
  2056: 30/05/23 - 23:00:00
  2060: 30/05/23 - 00:00:00
  2064: 31/05/23 - 00:00:00
  3076: 31/05/23 - 00:00:01
  4100: 31/05/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/05/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/05/00 - 23:59:59
  1048: 31/05/23 - 23:59:59
  2052: 31/05/23 - 23:59:00
  2056: 31/05/23 - 23:00:00
  2060: 31/05/23 - 00:00:00
  2064: 01/05/23 - 00:00:00
  2068: 01/06/23 - 00:00:00
  3076: 01/06/23 - 00:00:01
  4100: 01/06/23 - 00:00:02

End of June.

  $ visa_run_date 23:59:59 2023/06/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/06/00 - 23:59:59
  1048: 30/06/23 - 23:59:59
  2052: 30/06/23 - 23:59:00
  2056: 30/06/23 - 23:00:00
  2060: 30/06/23 - 00:00:00
  2064: 01/06/23 - 00:00:00
  2068: 01/07/23 - 00:00:00
  3076: 01/07/23 - 00:00:01
  4100: 01/07/23 - 00:00:02

End of July.

  $ visa_run_date 23:59:59 2023/07/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/07/00 - 23:59:59
  1048: 30/07/23 - 23:59:59
  2052: 30/07/23 - 23:59:00
  2056: 30/07/23 - 23:00:00
  2060: 30/07/23 - 00:00:00
  2064: 31/07/23 - 00:00:00
  3076: 31/07/23 - 00:00:01
  4100: 31/07/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/07/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/07/00 - 23:59:59
  1048: 31/07/23 - 23:59:59
  2052: 31/07/23 - 23:59:00
  2056: 31/07/23 - 23:00:00
  2060: 31/07/23 - 00:00:00
  2064: 01/07/23 - 00:00:00
  2068: 01/08/23 - 00:00:00
  3076: 01/08/23 - 00:00:01
  4100: 01/08/23 - 00:00:02

End of August.

  $ visa_run_date 23:59:59 2023/08/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/08/00 - 23:59:59
  1048: 30/08/23 - 23:59:59
  2052: 30/08/23 - 23:59:00
  2056: 30/08/23 - 23:00:00
  2060: 30/08/23 - 00:00:00
  2064: 31/08/23 - 00:00:00
  3076: 31/08/23 - 00:00:01
  4100: 31/08/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/08/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/08/00 - 23:59:59
  1048: 31/08/23 - 23:59:59
  2052: 31/08/23 - 23:59:00
  2056: 31/08/23 - 23:00:00
  2060: 31/08/23 - 00:00:00
  2064: 01/08/23 - 00:00:00
  2068: 01/09/23 - 00:00:00
  3076: 01/09/23 - 00:00:01
  4100: 01/09/23 - 00:00:02

End of September.

  $ visa_run_date 23:59:59 2023/09/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/09/00 - 23:59:59
  1048: 30/09/23 - 23:59:59
  2052: 30/09/23 - 23:59:00
  2056: 30/09/23 - 23:00:00
  2060: 30/09/23 - 00:00:00
  2064: 01/09/23 - 00:00:00
  2068: 01/10/23 - 00:00:00
  3076: 01/10/23 - 00:00:01
  4100: 01/10/23 - 00:00:02

End of October.

  $ visa_run_date 23:59:59 2023/10/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/10/00 - 23:59:59
  1048: 30/10/23 - 23:59:59
  2052: 30/10/23 - 23:59:00
  2056: 30/10/23 - 23:00:00
  2060: 30/10/23 - 00:00:00
  2064: 31/10/23 - 00:00:00
  3076: 31/10/23 - 00:00:01
  4100: 31/10/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/10/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/10/00 - 23:59:59
  1048: 31/10/23 - 23:59:59
  2052: 31/10/23 - 23:59:00
  2056: 31/10/23 - 23:00:00
  2060: 31/10/23 - 00:00:00
  2064: 01/10/23 - 00:00:00
  2068: 01/11/23 - 00:00:00
  3076: 01/11/23 - 00:00:01
  4100: 01/11/23 - 00:00:02

End of November.

  $ visa_run_date 23:59:59 2023/09/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/09/00 - 23:59:59
  1048: 30/09/23 - 23:59:59
  2052: 30/09/23 - 23:59:00
  2056: 30/09/23 - 23:00:00
  2060: 30/09/23 - 00:00:00
  2064: 01/09/23 - 00:00:00
  2068: 01/10/23 - 00:00:00
  3076: 01/10/23 - 00:00:01
  4100: 01/10/23 - 00:00:02

End of December.

  $ visa_run_date 23:59:59 2023/12/30 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 30/01/00 - 23:59:59
  1044: 30/12/00 - 23:59:59
  1048: 30/12/23 - 23:59:59
  2052: 30/12/23 - 23:59:00
  2056: 30/12/23 - 23:00:00
  2060: 30/12/23 - 00:00:00
  2064: 31/12/23 - 00:00:00
  3076: 31/12/23 - 00:00:01
  4100: 31/12/23 - 00:00:02

  $ visa_run_date 23:59:59 2023/12/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/12/00 - 23:59:59
  1048: 31/12/23 - 23:59:59
  2052: 31/12/23 - 23:59:00
  2056: 31/12/23 - 23:00:00
  2060: 31/12/23 - 00:00:00
  2064: 01/12/23 - 00:00:00
  2068: 01/01/23 - 00:00:00
  2072: 01/01/24 - 00:00:00
  3076: 01/01/24 - 00:00:01
  4100: 01/01/24 - 00:00:02

End of a century. See note on end of century in `visa-simulator.t`.

  $ visa_run_date 23:59:59 1999/12/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/12/00 - 23:59:59
  1048: 31/12/99 - 23:59:59
  2052: 31/12/99 - 23:59:00
  2056: 31/12/99 - 23:00:00
  2060: 31/12/99 - 00:00:00
  2064: 01/12/99 - 00:00:00
  2068: 01/01/99 - 00:00:00
  2072: 01/01/00 - 00:00:00
  3076: 01/01/00 - 00:00:01
  4100: 01/01/00 - 00:00:02

  $ visa_run_date 23:59:59 2099/12/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/12/00 - 23:59:59
  1048: 31/12/99 - 23:59:59
  2052: 31/12/99 - 23:59:00
  2056: 31/12/99 - 23:00:00
  2060: 31/12/99 - 00:00:00
  2064: 01/12/99 - 00:00:00
  2068: 01/01/99 - 00:00:00
  2072: 01/01/00 - 00:00:00
  3076: 01/01/00 - 00:00:01
  4100: 01/01/00 - 00:00:02

  $ visa_run_date 23:59:59 2199/12/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/12/00 - 23:59:59
  1048: 31/12/99 - 23:59:59
  2052: 31/12/99 - 23:59:00
  2056: 31/12/99 - 23:00:00
  2060: 31/12/99 - 00:00:00
  2064: 01/12/99 - 00:00:00
  2068: 01/01/99 - 00:00:00
  2072: 01/01/00 - 00:00:00
  3076: 01/01/00 - 00:00:01
  4100: 01/01/00 - 00:00:02

  $ visa_run_date 23:59:59 2999/12/31 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 31/01/00 - 23:59:59
  1044: 31/12/00 - 23:59:59
  1048: 31/12/99 - 23:59:59
  2052: 31/12/99 - 23:59:00
  2056: 31/12/99 - 23:00:00
  2060: 31/12/99 - 00:00:00
  2064: 01/12/99 - 00:00:00
  2068: 01/01/99 - 00:00:00
  2072: 01/01/00 - 00:00:00
  3076: 01/01/00 - 00:00:01
  4100: 01/01/00 - 00:00:02

Crossing minutes, hours, days.

  $ visa_run_date 17:10:58 2023/04/19 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:58
  1032: 01/01/00 - 00:10:58
  1036: 01/01/00 - 17:10:58
  1040: 19/01/00 - 17:10:58
  1044: 19/04/00 - 17:10:58
  1048: 19/04/23 - 17:10:58
  2052: 19/04/23 - 17:10:59
  3076: 19/04/23 - 17:10:00
  3080: 19/04/23 - 17:11:00
  4100: 19/04/23 - 17:11:01

  $ visa_run_date 17:59:58 2023/04/19 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:58
  1032: 01/01/00 - 00:59:58
  1036: 01/01/00 - 17:59:58
  1040: 19/01/00 - 17:59:58
  1044: 19/04/00 - 17:59:58
  1048: 19/04/23 - 17:59:58
  2052: 19/04/23 - 17:59:59
  3076: 19/04/23 - 17:59:00
  3080: 19/04/23 - 17:00:00
  3084: 19/04/23 - 18:00:00
  4100: 19/04/23 - 18:00:01

  $ visa_run_date 23:59:58 2023/04/19 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:58
  1032: 01/01/00 - 00:59:58
  1036: 01/01/00 - 23:59:58
  1040: 19/01/00 - 23:59:58
  1044: 19/04/00 - 23:59:58
  1048: 19/04/23 - 23:59:58
  2052: 19/04/23 - 23:59:59
  3076: 19/04/23 - 23:59:00
  3080: 19/04/23 - 23:00:00
  3084: 19/04/23 - 00:00:00
  3088: 20/04/23 - 00:00:00
  4100: 20/04/23 - 00:00:01

Leap Years: See note on leap years in `visa-simulator.t`.

  $ visa_run_date 23:59:59 2100/2/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  2052: 28/02/00 - 23:59:00
  2056: 28/02/00 - 23:00:00
  2060: 28/02/00 - 00:00:00
  2064: 29/02/00 - 00:00:00
  3076: 29/02/00 - 00:00:01
  4100: 29/02/00 - 00:00:02

  $ visa_run_date 23:59:59 2200/2/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  2052: 28/02/00 - 23:59:00
  2056: 28/02/00 - 23:00:00
  2060: 28/02/00 - 00:00:00
  2064: 29/02/00 - 00:00:00
  3076: 29/02/00 - 00:00:01
  4100: 29/02/00 - 00:00:02

  $ visa_run_date 23:59:59 2400/2/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  2052: 28/02/00 - 23:59:00
  2056: 28/02/00 - 23:00:00
  2060: 28/02/00 - 00:00:00
  2064: 29/02/00 - 00:00:00
  3076: 29/02/00 - 00:00:01
  4100: 29/02/00 - 00:00:02

  $ visa_run_date 23:59:59 3000/2/28 5000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:59
  1032: 01/01/00 - 00:59:59
  1036: 01/01/00 - 23:59:59
  1040: 28/01/00 - 23:59:59
  1044: 28/02/00 - 23:59:59
  2052: 28/02/00 - 23:59:00
  2056: 28/02/00 - 23:00:00
  2060: 28/02/00 - 00:00:00
  2064: 29/02/00 - 00:00:00
  3076: 29/02/00 - 00:00:01
  4100: 29/02/00 - 00:00:02

Addendum. There used to be a bug in the execution of the microprocessor that was
when noticeable when crossing centuries. The bug was that the seconds were not
passing steadily. The microprocessor somehow lagged just before crossing the
century, and then resumed its normal course. The test below was able to show
this problem, so we are keeping it to avoid a regression.

  $ visa_run_date 23:59:56 1999/12/31 10000
  0000: 01/01/00 - 00:00:00
  1028: 01/01/00 - 00:00:56
  1032: 01/01/00 - 00:59:56
  1036: 01/01/00 - 23:59:56
  1040: 31/01/00 - 23:59:56
  1044: 31/12/00 - 23:59:56
  1048: 31/12/99 - 23:59:56
  2052: 31/12/99 - 23:59:57
  3076: 31/12/99 - 23:59:58
  4100: 31/12/99 - 23:59:59
  5124: 31/12/99 - 23:59:00
  5128: 31/12/99 - 23:00:00
  5132: 31/12/99 - 00:00:00
  5136: 01/12/99 - 00:00:00
  5140: 01/01/99 - 00:00:00
  5144: 01/01/00 - 00:00:00
  6148: 01/01/00 - 00:00:01
  7172: 01/01/00 - 00:00:02
  8196: 01/01/00 - 00:00:03
  9220: 01/01/00 - 00:00:04

After the initialization phase, the microprocessor stabilizes on ticks falling
on cycles (1028 + i * 1024). According to this schedule, the expectation would
be to have:

- 2052: 31/12/99 - 23:59:57
- 3076: 31/12/99 - 23:59:58
- 4100: 31/12/99 - 23:59:59
x 5124: 01/01/00 - 00:00:00
- 6148: 01/01/00 - 00:00:01

However, it is not possible to update all digits at once. The next best, is for
the change to start occurring exactly on tempo, even if it takes a few cycles
for all the digits to update. This is the case here, between the cycles 5124 (on
the beat) and cycles 5144, all the digits have been updated, and the micro
resumes its cycles from there.
